
# Repository Setup: joeromance84/kivy-app

## 1. GitHub Repository Configuration

### Add cloudbuild.yaml to repository root:
```yaml
# This file was generated by EchoNexus AGI for joeromance84/kivy-app
{
  "steps": [
    {
      "name": "gcr.io/cloud-builders/python",
      "args": [
        "pip",
        "install",
        "--upgrade",
        "pip",
        "setuptools",
        "wheel"
      ],
      "env": [
        "PYTHONPATH=/workspace",
        "PIP_CACHE_DIR=/workspace/.pip-cache"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/python",
      "args": [
        "pip",
        "install",
        "-r",
        "requirements.txt"
      ],
      "env": [
        "PYTHONPATH=/workspace"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/python",
      "args": [
        "pip",
        "install",
        "kivy[base]",
        "buildozer",
        "cython==0.29.33"
      ],
      "timeout": "600s"
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "entrypoint": "bash",
      "args": [
        "-c",
        "\n                        export ANDROID_HOME=/opt/android-sdk\n                        export ANDROID_SDK_ROOT=/opt/android-sdk\n                        export PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools\n                        echo \"Build environment configured for ${_REPO_NAME}\"\n                        "
      ],
      "env": [
        "ANDROID_HOME=/opt/android-sdk",
        "ANDROID_SDK_ROOT=/opt/android-sdk"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/python",
      "args": [
        "buildozer",
        "android",
        "debug"
      ],
      "timeout": "3600s",
      "env": [
        "ANDROID_HOME=/opt/android-sdk",
        "BUILDOZER_BUILD_DIR=/workspace/.buildozer"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "entrypoint": "bash",
      "args": [
        "-c",
        "\n                        mkdir -p /workspace/artifacts\n                        cp bin/*.apk /workspace/artifacts/ 2>/dev/null || echo \"No APK found\"\n                        \n                        # Create build metadata\n                        cat > /workspace/artifacts/build-info.json << EOF\n                        {\n                          \"repo\": \"${_REPO_NAME}\",\n                          \"owner\": \"${_GITHUB_OWNER}\",\n                          \"build_id\": \"$BUILD_ID\",\n                          \"commit_sha\": \"$COMMIT_SHA\",\n                          \"branch\": \"$BRANCH_NAME\",\n                          \"build_time\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\",\n                          \"builder\": \"echonexus-agi\"\n                        }\n                        EOF\n                        \n                        ls -la /workspace/artifacts/\n                        "
      ]
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "args": [
        "gsutil",
        "-m",
        "cp",
        "-r",
        "/workspace/artifacts/*",
        "gs://${_STORAGE_BUCKET}/${_GITHUB_OWNER}/${_REPO_NAME}/$BUILD_ID/"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "entrypoint": "bash",
      "args": [
        "-c",
        "\n                        echo \"$BUILD_ID\" | gsutil cp - gs://${_STORAGE_BUCKET}/${_GITHUB_OWNER}/${_REPO_NAME}/latest-build-id.txt\n                        echo \"Latest build updated: $BUILD_ID\"\n                        "
      ]
    }
  ],
  "timeout": "7200s",
  "options": {
    "substitution_option": "ALLOW_LOOSE",
    "dynamic_substitutions": true,
    "logging": "CLOUD_LOGGING_ONLY",
    "disk_size_gb": 100,
    "machine_type": "E2_HIGHCPU_8"
  },
  "substitutions": {
    "_STORAGE_BUCKET": "${PROJECT_ID}-builds",
    "_REPO_NAME": "kivy-app",
    "_GITHUB_OWNER": "joeromance84",
    "_DEPLOY_ENV": "production"
  },
  "artifacts": {
    "objects": {
      "location": "gs://${_STORAGE_BUCKET}/${_GITHUB_OWNER}/${_REPO_NAME}/$BUILD_ID",
      "paths": [
        "/workspace/artifacts/*"
      ]
    }
  }
}
```

### Create .github/workflows/backup-build.yml:
```yaml
name: Backup Build (GitHub Actions)
on:
  workflow_dispatch:
  push:
    branches: [main]
    paths: ['[backup-build]**']

jobs:
  backup-build:
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, '[backup-build]') || github.event_name == 'workflow_dispatch'
    
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        pip install buildozer cython
    
    - name: Build APK (Backup)
      run: buildozer android debug
    
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: kivy-app-backup-apk
        path: bin/*.apk
```

## 2. Google Cloud Build Integration

Project: Connected to Logan.lorentz9@gmail.com
Trigger: Auto-builds on push to main/master/develop branches
Storage: gs://[PROJECT_ID]-builds/joeromance84/kivy-app/

## 3. Build Artifacts Organization

```
gs://echonexus-builds/
├── joeromance84/
│   ├── kivy-app/
│   │   ├── [BUILD_ID]/
│   │   │   ├── app-debug.apk
│   │   │   └── build-info.json
│   │   └── latest-build-id.txt
│   └── [other-repos]/
└── build-logs/
```

## 4. Verification Commands

```bash
# Check build status
gcloud builds list --filter="substitutions._REPO_NAME=kivy-app"

# Download latest APK
gsutil cp gs://echonexus-builds/joeromance84/kivy-app/$(gsutil cat gs://echonexus-builds/joeromance84/kivy-app/latest-build-id.txt)/*.apk ./

# View build logs
gcloud builds log [BUILD_ID]
```
